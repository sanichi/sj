var skyjo = (function() {

  const player = <%= @player.id %>;
  const admin = <%= current_user.admin? ? 'true' : 'false' %>;

  var elm;
  var polling = true;
  var data = {
    player: player,
    number: 0,
  };

  function poll() {
    $.ajax('/updates.json', {

      data: data,

      dataType: 'json',

      success: function(json, status, xhr) {
        $.each(json.updates, function(i, update) {
          elm.ports.updates.send(update);
        });
        // if (admin) $('#responses').append('<pre>' + prettyPrintJson.toHtml(json) + '</pre>');
        $('#responses').append('<pre>' + prettyPrintJson.toHtml(json) + '</pre>');
      },

      error: function(xhr) {
        console.log("ajax error: " + xhr.status);
      },

      complete: function(xhr) {
        if (polling) setTimeout(poll, 10000);
        data.number += 1;
      }

    });
  }

  function set_elm(app) {
    elm = app;
  }

  return {
    poll: poll,
    set_elm: set_elm
  };

})();

$(function() {
  var app = Elm.Main.init({
    node: $('#elm-main').get(0)
  });
  skyjo.set_elm(app);
  skyjo.poll();
});


var skyjo = (function() {

  const user_id = <%= current_user.id %>;
  const admin = <%= current_user.admin? ? 'true' : 'false' %>;
  let polling = true;
  var data = {
    user_id: user_id,
    message: 'initialize'
  };

  function poll() {
    $.ajax('/ping.json', {

      data: data,

      dataType: 'json',

      success: function(json, status, xhr) {
        if (admin) $('#responses').append('<pre>' + prettyPrintJson.toHtml(json) + '</pre>');
      },

      error: function(xhr) {
        console.log("ajax error: " + xhr.status);
      },

      complete: function(xhr) {
        if (polling) setTimeout(poll, 10000);
      }

    });
  }

  return {
    poll: poll
  };

})();

$(function() {
  skyjo.poll();
});

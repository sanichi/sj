var skyjo = (function() {

  const user_id = <%= current_user.id %>;
  const admin = <%= current_user.admin? ? 'true' : 'false' %>;

  var elm;
  var polling = true;
  var data = {
    user_id: user_id,
    message: 'initialize'
  };

  function poll() {
    $.ajax('/ping.json', {

      data: data,

      dataType: 'json',

      success: function(json, status, xhr) {
        if (admin) $('#responses').append('<pre>' + prettyPrintJson.toHtml(json) + '</pre>');
        elm.ports.updates.send(json);
      },

      error: function(xhr) {
        console.log("ajax error: " + xhr.status);
      },

      complete: function(xhr) {
        if (polling) setTimeout(poll, 10000);
      }

    });
  }

  function set_elm(app) {
    elm = app;
  }

  return {
    poll: poll,
    set_elm: set_elm
  };

})();

$(function() {
  var app = Elm.Main.init({
    node: $('#elm-main').get(0)
  });
  skyjo.set_elm(app);
  skyjo.poll();
});
